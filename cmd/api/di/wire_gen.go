// Code generated by Wire. DO NOT EDIT.

//go:generate go run -mod=mod github.com/google/wire/cmd/wire gen -tags "wireinject"
//go:build !wireinject
// +build !wireinject

package di

import (
	"github.com/google/wire"
	"github.com/jackc/pgx/v5/pgxpool"
	"github.com/redis/go-redis/v9"
	"go-fiber-core/internal/database/connections/gorm"
	"go-fiber-core/internal/database/connections/pgx"
	redis2 "go-fiber-core/internal/database/connections/redis"
	"go-fiber-core/internal/dtos/config"
	"go-fiber-core/internal/dtos/connect"
	"go-fiber-core/internal/handlers"
	"go-fiber-core/internal/models"
	"go-fiber-core/internal/repositories/bank"
	"go-fiber-core/internal/repositories/menu"
	"go-fiber-core/internal/repositories/refreshtoken"
	"go-fiber-core/internal/repositories/user"
	"go-fiber-core/internal/server"
	"go-fiber-core/internal/services"
	"go-fiber-core/internal/services/auth"
	bank2 "go-fiber-core/internal/services/bank"
	menu2 "go-fiber-core/internal/services/menu"
	"go-fiber-core/internal/services/pagination"
	user2 "go-fiber-core/internal/services/user"
)

// Injectors from wire.go:

func InitializeServer(configPath string) (*server.FiberServer, func(), error) {
	appConfig, err := provideAppConfig(configPath)
	if err != nil {
		return nil, nil, err
	}
	gormConnectService, cleanup, err := provideGormService(appConfig)
	if err != nil {
		return nil, nil, err
	}
	pgxWritePool, cleanup2, err := providePgxWritePool(appConfig)
	if err != nil {
		cleanup()
		return nil, nil, err
	}
	pgxReadPool, cleanup3, err := providePgxReadPool(appConfig)
	if err != nil {
		cleanup2()
		cleanup()
		return nil, nil, err
	}
	client, cleanup4, err := provideRedisClient(appConfig)
	if err != nil {
		cleanup3()
		cleanup2()
		cleanup()
		return nil, nil, err
	}
	connectDTO := provideConnectDTO(gormConnectService, pgxWritePool, pgxReadPool, client)
	userReader := user.NewUserReaderRepo()
	refreshTokenReader := refreshtoken.NewRefreshTokenReaderRepo()
	refreshTokenWriter := refreshtoken.NewRefreshTokenWriterRepo()
	refreshTokenRepository := refreshtoken.NewRefreshTokenRepository(refreshTokenReader, refreshTokenWriter)
	tokenService := provideTokenService(appConfig)
	menuReader := menu.NewMenuReaderRepository(connectDTO)
	menuReaderService := menu2.NewMenuReaderService(menuReader)
	authService := auth.NewAuthService(userReader, refreshTokenRepository, tokenService, menuReaderService, connectDTO)
	authHandler := handlers.NewAuthHandler(authService)
	userWriter := user.NewUserWriterRepo()
	userWriterService := user2.NewUserWriterService(connectDTO, userWriter, userReader)
	paginationService := provideUserPaginationService()
	userPaginator := user.NewUserPaginatorRepo(paginationService)
	userReaderService := user2.NewUserReaderService(connectDTO, userReader, userPaginator)
	userHandler := handlers.NewUserHandler(userWriterService, userReaderService)
	bankWriter := bank.NewBankWriterRepo()
	bankReader := bank.NewBankReaderRepo()
	bankWriterService := bank2.NewBankWriterService(connectDTO, bankWriter, bankReader)
	bankReaderService := bank2.NewBankReaderService(connectDTO, bankReader)
	paginationPaginationService := provideBankPaginationService()
	bankPagination := bank.NewBankPaginationRepo(paginationPaginationService)
	bankPaginationService := bank2.NewBankPaginationService(connectDTO, bankPagination)
	bankHandler := handlers.NewBankHandler(bankWriterService, bankReaderService, bankPaginationService)
	menuWriter := menu.NewMenuWriterRepository(connectDTO)
	menuWriterService := menu2.NewMenuWriterService(menuWriter, connectDTO)
	menuHandler := handlers.NewMenuHandler(menuWriterService, menuReaderService)
	databaseService := services.NewDatabaseService(appConfig, connectDTO)
	databaseHandler := handlers.NewDatabaseHandler(databaseService)
	fiberServer, cleanup5, err := server.NewFiberServer(appConfig, connectDTO, authHandler, userHandler, bankHandler, menuHandler, databaseHandler, tokenService, userWriterService)
	if err != nil {
		cleanup4()
		cleanup3()
		cleanup2()
		cleanup()
		return nil, nil, err
	}
	return fiberServer, func() {
		cleanup5()
		cleanup4()
		cleanup3()
		cleanup2()
		cleanup()
	}, nil
}

// wire.go:

type PgxWritePool *pgxpool.Pool

type PgxReadPool *pgxpool.Pool

func provideAppConfig(configPath string) (*config.AppConfig, error) {
	return config.NewAppConfig(configPath)
}

func provideGormService(cfg *config.AppConfig) (*gorm.GormConnectService, func(), error) {
	return gorm.NewGormConnectService(cfg.MultiDatabaseConfig)
}

func provideRedisClient(cfg *config.AppConfig) (*redis.Client, func(), error) {
	return redis2.NewRedisClient(cfg.Redis)
}

func providePgxWritePool(cfg *config.AppConfig) (PgxWritePool, func(), error) {
	pool, cleanup, err := pgx.NewPgxConnection(cfg.MultiDatabaseConfig.Pgx.Write)
	return PgxWritePool(pool), cleanup, err
}

func providePgxReadPool(cfg *config.AppConfig) (PgxReadPool, func(), error) {
	pool, cleanup, err := pgx.NewPgxConnection(cfg.MultiDatabaseConfig.Pgx.Read)
	return PgxReadPool(pool), cleanup, err
}

func provideConnectDTO(
	gormService *gorm.GormConnectService,
	writePool PgxWritePool,
	readPool PgxReadPool,
	redisClient *redis.Client,
) *connect.ConnectDTO {
	return &connect.ConnectDTO{
		ConnectGormWrite: gormService.GetWriteDB(),
		ConnectGormRead:  gormService.GetReadDB(),
		ConnectPgxWrite:  (*pgxpool.Pool)(writePool),
		ConnectPgxRead:   (*pgxpool.Pool)(readPool),
		ConnectRedis:     redisClient,
	}
}

func provideTokenService(cfg *config.AppConfig) auth.TokenService {
	return auth.NewTokenService(cfg)
}

func provideUserPaginationService() *pagination.PaginationService[models.User] {
	return pagination.NewPaginationService[models.User]()
}

func provideBankPaginationService() *pagination.PaginationService[models.Bank] {
	return pagination.NewPaginationService[models.Bank]()
}

var connectionSet = wire.NewSet(
	provideGormService,
	provideRedisClient,
	providePgxWritePool,
	providePgxReadPool,
	provideConnectDTO,
)

var repositorySet = wire.NewSet(user.NewUserReaderRepo, user.NewUserWriterRepo, user.NewUserPaginatorRepo, user.NewUserRepository, bank.NewBankReaderRepo, bank.NewBankWriterRepo, bank.NewBankCrudRepository, bank.NewBankPaginationRepo, menu.NewMenuReaderRepository, menu.NewMenuWriterRepository, refreshtoken.NewRefreshTokenReaderRepo, refreshtoken.NewRefreshTokenWriterRepo, refreshtoken.NewRefreshTokenRepository)

var serviceSet = wire.NewSet(
	provideTokenService, auth.NewAuthService, provideUserPaginationService,
	provideBankPaginationService, services.NewTransactionManager, services.NewDatabaseService, user2.NewUserReaderService, user2.NewUserWriterService, bank2.NewBankReaderService, bank2.NewBankWriterService, bank2.NewBankPaginationService, bank2.NewDeactivationService, menu2.NewMenuReaderService, menu2.NewMenuWriterService,
)

var handlerSet = wire.NewSet(handlers.NewAuthHandler, handlers.NewUserHandler, handlers.NewBankHandler, handlers.NewDatabaseHandler, handlers.NewMenuHandler)
